<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Conduit_lwt_ssl (conduit-lwt-ssl.Conduit_lwt_ssl)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../index.html">conduit-lwt-ssl</a> &#x00BB; Conduit_lwt_ssl</nav><h1>Module <code>Conduit_lwt_ssl</code></h1><p>Implementation of the SSL support (according <code>Lwt_ssl</code>) with <code>conduit-lwt</code>.</p><p>This implementation assumes that underlying protocol used to compose with SSL must deliver a <code>Lwt_unix.file_descr</code> - such as <code>Conduit_lwt.TCP</code>. From that, we are able to compose your protocol with <code>Lwt_ssl</code> such as:</p><pre><code class="ml">let ssl_protocol = protocol_with_ssl TCP.protocol
let ssl_service = service_with_ssl TCP.service
  ~file_descr:TCP.file_descr ssl_protocol</code></pre><p>Then, TCP + SSL is available as any others <code>conduit</code> protocols or services registered.</p><p><b>NOTE</b>: <code>close</code> implementation properly closes an SSL connection with <code>Ssl.ssl_shutdown</code> AND properly closes the underlying file-descriptor by itself. From a given implementation of a protocol like <code>TCP</code>, <code>TCP.close</code> will never be called by the SSL layer - but the file-descriptor will be closed.</p><p><b>NOTE</b>: <code>verify</code> is called after a call to <code>flow</code> (which should do the <code>connect</code> call). So, nothing was exchanged between you and your peer at this time - even the handshake. It permits to fill the SSL socket with some information such as the hostname of the peer with <code>Ssl.set_client_SNI_hostname</code>.</p></header><dl><dt class="spec type" id="type-endpoint"><a href="#type-endpoint" class="anchor"></a><code><span class="keyword">type</span> <span>('edn, 'flow) endpoint</span></code><code> = </code><code>{</code><table class="record"><tr id="type-endpoint.context" class="anchored"><td class="def field"><a href="#type-endpoint.context" class="anchor"></a><code>context : Ssl.context;</code></td></tr><tr id="type-endpoint.endpoint" class="anchored"><td class="def field"><a href="#type-endpoint.endpoint" class="anchor"></a><code>endpoint : <span class="type-var">'edn</span>;</code></td></tr><tr id="type-endpoint.verify" class="anchored"><td class="def field"><a href="#type-endpoint.verify" class="anchor"></a><code>verify : Ssl.context <span>&#45;&gt;</span> <span class="type-var">'flow</span> <span>&#45;&gt;</span> <span><span><span>(Lwt_ssl.socket, <span>[ <span>`Verify of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span>;</code></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-endpoint"><a href="#val-endpoint" class="anchor"></a><code><span class="keyword">val</span> endpoint : <span>file_descr:<span>(<span class="type-var">'flow</span> <span>&#45;&gt;</span> Lwt_unix.file_descr)</span></span> <span>&#45;&gt;</span> <span>context:Ssl.context</span> <span>&#45;&gt;</span> <span>?&#8288;verify:<span>(Ssl.context <span>&#45;&gt;</span> <span class="type-var">'flow</span> <span>&#45;&gt;</span> <span><span><span>(Lwt_ssl.socket, <span>[ <span>`Verify of string</span> ]</span>)</span> Stdlib.result</span> Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span class="type-var">'edn</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'edn</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-endpoint">endpoint</a></span></code></dt><dd><p><code>endpoint ~file_descr ~context ?verify edn</code> returns an <i>endpoint</i> needed to initialize a SSL connection from a <code>Lwt.file_descr</code>. Even if <code>endpoint</code> is abstracted over the type of the <code>'flow</code>, we must be able to extract an <code>Lwt_unix.file_descr</code> from it.</p><p><code>verify</code> is the function called just after the initialization of the underlying <code>'flow</code>. It permits to request a verification such as the <i>hostname</i> with your peer.</p></dd></dl><dl><dt class="spec value" id="val-protocol_with_ssl"><a href="#val-protocol_with_ssl" class="anchor"></a><code><span class="keyword">val</span> protocol_with_ssl : <span><span>(<span class="type-var">'edn</span>, <span class="type-var">'flow</span>)</span> <a href="../../conduit-lwt/Conduit_lwt/index.html#type-protocol">Conduit_lwt.protocol</a></span> <span>&#45;&gt;</span> <span><span>(<span><span>(<span class="type-var">'edn</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-endpoint">endpoint</a></span>, Lwt_ssl.socket)</span> <a href="../../conduit-lwt/Conduit_lwt/index.html#type-protocol">Conduit_lwt.protocol</a></span></code></dt><dd><p><code>protocol_with_ssl ~key protocol</code> returns a representation of the given protocol with SSL.</p></dd></dl><dl><dt class="spec type" id="type-service"><a href="#type-service" class="anchor"></a><code><span class="keyword">type</span> <span>'t service</span></code></dt><dd><p>The type for SSL services.</p></dd></dl><dl><dt class="spec value" id="val-service_with_ssl"><a href="#val-service_with_ssl" class="anchor"></a><code><span class="keyword">val</span> service_with_ssl : <span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="../../conduit-lwt/Conduit_lwt/Service/index.html#type-service">Conduit_lwt.Service.service</a></span> <span>&#45;&gt;</span> <span>file_descr:<span>(<span class="type-var">'flow</span> <span>&#45;&gt;</span> Lwt_unix.file_descr)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'edn</span>, Lwt_ssl.socket)</span> <a href="../../conduit-lwt/Conduit_lwt/index.html#type-protocol">Conduit_lwt.protocol</a></span> <span>&#45;&gt;</span> <span><span>(Ssl.context * <span class="type-var">'cfg</span>, <span><span class="type-var">'t</span> <a href="index.html#type-service">service</a></span>, Lwt_ssl.socket)</span> <a href="../../conduit-lwt/Conduit_lwt/Service/index.html#type-service">Conduit_lwt.Service.service</a></span></code></dt><dd><p><code>service_with_ssl ~key service ~file_descr ssl_protocol</code> returns a representation of the given service with SSL. The service deliver an SSL flow which must be described by a <code>Lwt_ssl.socket Witness.protocol</code> (eg. <a href="index.html#val-protocol_with_ssl"><code>protocol_with_ssl</code></a>).</p><p><code>file_descr</code> is used to extract from the given <code>'flow</code> delivered by our service a <code>Lwt_unix.file_descr</code> needed to create a <code>Lwt_ssl.socket</code>.</p></dd></dl><div class="spec module" id="module-TCP"><a href="#module-TCP" class="anchor"></a><code><span class="keyword">module</span> <a href="TCP/index.html">TCP</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></div></body></html>