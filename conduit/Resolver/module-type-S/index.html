<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (conduit.Resolver.S)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../../index.html">conduit</a></span></nav><header><h1><span class="keyword">Module type</span> <span class="module-path">Resolver.S</span></h1></header><div class="doc"><p>Module type for a <span class="xref-unresolved" title="unresolved reference to &quot;resolution&quot;">resolver</span> that can map URIs to
concrete <span class="xref-unresolved" title="unresolved reference to &quot;endp&quot;">endpoints</span> that stream connections can be
established with.</p></div><div class="spec type" id="type-io"><a href="#type-io" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>+'a io</code><code></code><code></code></div><div class="doc"><p>Abstract type of the cooperative threading library used, normally
defined via the IO module type</p></div></div><div class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>t</code><code></code><code></code></div><div class="doc"><p>State handle for a running resolver</p></div></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><div class="spec val" id="val-t_of_sexp"><a href="#val-t_of_sexp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>t_of_sexp : Ppx_sexp_conv_lib.Sexp.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"></div></div><div class="spec val" id="val-sexp_of_t"><a href="#val-sexp_of_t" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>sexp_of_t : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> Ppx_sexp_conv_lib.Sexp.t</code></div><div class="doc"></div></div></details></div><div class="spec type" id="type-svc"><a href="#type-svc" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>svc</code><code></code><code></code></div><div class="doc"><p>Abstract type for a service entry, which maps a URI scheme into
a protocol handler and TCP port</p></div></div><div class="spec include"><div class="doc"></div><details open="open"><summary><span class="def"><code><span class="keyword">include </span><span class="keyword">sig</span> ... <span class="keyword">end</span></code></span></summary><div class="spec val" id="val-svc_of_sexp"><a href="#val-svc_of_sexp" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>svc_of_sexp : Ppx_sexp_conv_lib.Sexp.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-svc">svc</a></code></div><div class="doc"></div></div><div class="spec val" id="val-sexp_of_svc"><a href="#val-sexp_of_svc" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>sexp_of_svc : <a href="index.html#type-svc">svc</a> <span class="keyword">&#8209;&gt;</span> Ppx_sexp_conv_lib.Sexp.t</code></div><div class="doc"></div></div></details></div><div class="spec type" id="type-rewrite_fn"><a href="#type-rewrite_fn" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>rewrite_fn</code><code><span class="keyword"> = </span><a href="index.html#type-svc">svc</a> <span class="keyword">&#8209;&gt;</span> Uri.t <span class="keyword">&#8209;&gt;</span> <a href="../../Conduit/index.html#type-endp">Conduit.endp</a> <a href="index.html#type-io">io</a></code><code></code></div><div class="doc"><p>A rewrite function resolves a <a href="index.html#type-svc">service</a> and a URI into
a concrete endpoint.</p></div></div><div class="spec type" id="type-service_fn"><a href="#type-service_fn" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>service_fn</code><code><span class="keyword"> = </span>string <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-svc">svc</a> option <a href="index.html#type-io">io</a></code><code></code></div><div class="doc"><p>A service function maps the string (such as <code class="code">http</code> or <code class="code">ftp</code>) from
a URI scheme into a <a href="index.html#type-svc">service</a> description that includes
enough metadata about the service to subsequently <a href="index.html#type-rewrite_fn">resolve</a>
it into an <span class="xref-unresolved" title="unresolved reference to &quot;endp&quot;">endpoint</span>.</p></div></div><div class="spec val" id="val-(++)"><a href="#val-(++)" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>(++) : <a href="index.html#type-service_fn">service_fn</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-service_fn">service_fn</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-service_fn">service_fn</a></code></div><div class="doc"><p><code class="code">f ++ g</code> is the composition of the service functions <code class="code">f</code> and
<code class="code">g</code>.</p></div></div><div class="spec val" id="val-init"><a href="#val-init" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>init : ?&#8288;service:<a href="index.html#type-service_fn">service_fn</a> <span class="keyword">&#8209;&gt;</span> ?&#8288;rewrites:(string<span class="keyword"> * </span><a href="index.html#type-rewrite_fn">rewrite_fn</a>) list <span class="keyword">&#8209;&gt;</span> unit <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a></code></div><div class="doc"><p><code class="code">init ?service ?rewrites</code> will initialize the resolver and return
a state handler. The <a href="index.html#type-service_fn">service</a> argument should
contain the system-specific resolution mechanism for URI schemas.</p><p>The <code class="code">rewrites</code> argument can optionally override a subset of the
URI domain name with the given <a href="index.html#type-rewrite_fn">rewrite_fn</a> to permit custom
resolution rules. For example, a rewrite rule for &quot;.xen&quot; would
let the rewrite function resolve hostnames such as &quot;foo.xen&quot;
into a shared memory channel for the &quot;foo&quot; virtual machine.</p></div></div><div class="spec val" id="val-add_rewrite"><a href="#val-add_rewrite" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_rewrite : host:string <span class="keyword">&#8209;&gt;</span> f:<a href="index.html#type-rewrite_fn">rewrite_fn</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"><p><code class="code">add_rewrite ~host f t</code> will add to the <code class="code">t</code> resolver the <code class="code">f</code> rewrite rule
for all the domain names that shortest-prefix match <code class="code">host</code></p></div></div><div class="spec val" id="val-set_service"><a href="#val-set_service" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>set_service : f:<a href="index.html#type-service_fn">service_fn</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> unit</code></div><div class="doc"></div></div><div class="spec val" id="val-service"><a href="#val-service" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>service : <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-service_fn">service_fn</a></code></div><div class="doc"><p><code class="code">service t</code> is the function which is called when trying to
resolve a hostname with <code class="code">t</code>.</p></div></div><div class="spec val" id="val-resolve_uri"><a href="#val-resolve_uri" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>resolve_uri : ?&#8288;rewrites:(string<span class="keyword"> * </span><a href="index.html#type-rewrite_fn">rewrite_fn</a>) list <span class="keyword">&#8209;&gt;</span> uri:Uri.t <span class="keyword">&#8209;&gt;</span> <a href="index.html#type-t">t</a> <span class="keyword">&#8209;&gt;</span> <a href="../../Conduit/index.html#type-endp">Conduit.endp</a> <a href="index.html#type-io">io</a></code></div><div class="doc"><p><code class="code">resolve_uri ?rewrites ~uri t</code> will use <code class="code">t</code> to resolve the
<code class="code">uri</code> into a concrete endpoint. Any <code class="code">rewrites</code> that are passed
in will be overlayed on the existing rules within the <code class="code">t</code>
resolver, but not otherwise modify it.</p></div></div></body></html>