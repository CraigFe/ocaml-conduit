<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Service (conduit-async.Conduit_async.Service)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">conduit-async</a> &#x00BB; <a href="../index.html">Conduit_async</a> &#x00BB; Service</nav><h1>Module <code>Conduit_async.Service</code></h1></header><dl><dt class="spec type" id="type-impl"><a href="#type-impl" class="anchor"></a><code><span class="keyword">type</span> <span>('cfg, 't, 'flow) impl</span></code><code> = <span>(<span class="keyword">module</span> <a href="../module-type-SERVICE/index.html">SERVICE</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-configuration">configuration</a> = <span class="type-var">'cfg</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-flow">flow</a> = <span class="type-var">'flow</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-t">t</a> = <span class="type-var">'t</span>)</span></code></dt><dt class="spec type" id="type-service"><a href="#type-service" class="anchor"></a><code><span class="keyword">type</span> <span>('cfg, 't, 'flow) service</span></code></dt><dd><p>The type for services, e.g. service-side protocols. <code>'cfg</code> is the type for configuration, <code>'t</code> is the type for state states. <code>'flow</code> is the type for underlying flows.</p></dd></dl><dl><dt class="spec value" id="val-equal"><a href="#val-equal" class="anchor"></a><code><span class="keyword">val</span> equal : <span><span>(<span class="type-var">'cfg0</span>, <span class="type-var">'t0</span>, <span class="type-var">'flow0</span>)</span> <a href="index.html#type-service">service</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'cfg1</span>, <span class="type-var">'t1</span>, <span class="type-var">'flow1</span>)</span> <a href="index.html#type-service">service</a></span> <span>&#45;&gt;</span> <span><span>(<span><span>(<span class="type-var">'cfg0</span>, <span class="type-var">'cfg1</span>)</span> <a href="../../../conduit/Conduit/index.html#type-refl">Conduit.refl</a></span> * <span><span>(<span class="type-var">'t0</span>, <span class="type-var">'t1</span>)</span> <a href="../../../conduit/Conduit/index.html#type-refl">Conduit.refl</a></span> * <span><span>(<span class="type-var">'flow0</span>, <span class="type-var">'flow1</span>)</span> <a href="../../../conduit/Conduit/index.html#type-refl">Conduit.refl</a></span>)</span> option</span></code></dt><dd><p><code>equal svc0 svc1 </code> proves that <code>svc0</code> and <code>svc1</code> are physically the same. For instance, <code>Conduit</code> asserts:</p><pre><code class="ml">let service = Service.register ~service:(module V) ;;

let () = match Service.equal service service with
  | Some (Refl, Refl, Refl) -&gt; ...
  | _ -&gt; assert false</code></pre></dd></dl><dl><dt class="spec value" id="val-register"><a href="#val-register" class="anchor"></a><code><span class="keyword">val</span> register : <span>service:<span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-impl">impl</a></span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-service">service</a></span></code></dt><dd><p><code>register ~service</code> is the service using the implementation <code>service</code>. <code>service</code> must define <code>make</code> and <code>accept</code> function to be able to create server-side flows.</p><p>For instance:</p><pre><code class="ml">module TCP : SERVICE with type configuration = Unix.sockaddr
                      and type t = Unix.file_descr
                      and type flow = Unix.file_descr

let tcp_service : (Unix.sockaddr, Unix.file_descr, Unix.file_descr) Service.service =
  Service.register ~service:(module TCP)</code></pre></dd></dl><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code> = <code>[ </code><table class="variant"><tr id="type-error.Msg" class="anchored"><td class="def constructor"><a href="#type-error.Msg" class="anchor"></a><code>| </code><code>`Msg <span class="keyword">of</span> string</code></td></tr></table><code> ]</code></dt></dl><dl><dt class="spec value" id="val-pp_error"><a href="#val-pp_error" class="anchor"></a><code><span class="keyword">val</span> pp_error : <span><a href="index.html#type-error">error</a> Fmt.t</span></code></dt><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <span class="type-var">'cfg</span> <span>&#45;&gt;</span> <span>service:<span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-service">service</a></span></span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'t</span>, <span>[&gt; <a href="index.html#type-error">error</a> ]</span>)</span> Stdlib.result</span> <a href="../index.html#type-io">io</a></span></code></dt><dd><p><code>init cfg ~service</code> initialises the service with the configuration <code>cfg</code>.</p></dd></dl><dl><dt class="spec value" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span class="keyword">val</span> accept : <span>service:<span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-service">service</a></span></span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <span><span><span>(<span class="type-var">'flow</span>, <span>[&gt; <a href="index.html#type-error">error</a> ]</span>)</span> Stdlib.result</span> <a href="../index.html#type-io">io</a></span></code></dt><dd><p><code>accept service t</code> waits for a connection on the service <code>t</code>. The result is a <i>flow</i> connected to the client.</p></dd></dl><dl><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <span>service:<span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-service">service</a></span></span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <span><span><span>(unit, <span>[&gt; <a href="index.html#type-error">error</a> ]</span>)</span> Stdlib.result</span> <a href="../index.html#type-io">io</a></span></code></dt><dd><p><code>close ~service t</code> releases the resources associated to the server <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-impl"><a href="#val-impl" class="anchor"></a><code><span class="keyword">val</span> impl : <span><span>(<span class="type-var">'cfg</span>, <span class="type-var">'t</span>, <span class="type-var">'flow</span>)</span> <a href="index.html#type-service">service</a></span> <span>&#45;&gt;</span> <span>(<span class="keyword">module</span> <a href="../module-type-SERVICE/index.html">SERVICE</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-configuration">configuration</a> = <span class="type-var">'cfg</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-flow">flow</a> = <span class="type-var">'flow</span> <span class="keyword">and</span> <span class="keyword">type</span> <a href="../module-type-SERVICE/index.html#type-t">t</a> = <span class="type-var">'t</span>)</span></code></dt><dd><p><code>impl service</code> is <code>service</code>'s underlying implementation.</p></dd></dl></div></body></html>